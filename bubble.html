<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <style>
        html,
        body {
            padding: 0;
            margin: 0;
            overflow: hidden;
        }

        canvas {
            background-color: #202020;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        class Circle {
            constructor() {
                const winH = window.innerHeight
                const winW = window.innerWidth

                this.radius = Math.random() * 30 + 10
                this.site = {
                    x: Math.random() * (winW - this.radius * 2) + this.radius,
                    y: Math.random() * (winH - this.radius * 2) + this.radius,
                }
                this.direction = {
                    x: Math.random() * -0.1,
                    y: Math.random() * -0.5 - 0.1,
                }

                this.alpha = {
                    val: 0,// Math.random() * 100
                    times: 0,
                    speed: Math.random() * 0.0004 + 0.0003,
                    limit: 0.2
                }
                this.color = { r: 0, b: 0, g: 0 }
            }
            static get init() {
                return new Circle()
            }

            update() {
                this.alpha.val += this.alpha.speed
                this.site.y += this.direction.y

                if (this.alpha.val >= this.alpha.limit) {
                    this.alpha.speed = -this.alpha.speed
                    this.alpha.val = this.alpha.limit + this.alpha.speed
                    this.alpha.times += 1
                } else if (this.alpha.val <= 0) {
                    this.alpha.speed = -this.alpha.speed
                    this.alpha.val = this.alpha.speed
                    this.alpha.times += 1
                }


                return this
            }
        }

        class Draw {
            constructor(canvas) {
                this.canvas = canvas
            }
            static init(canvas) { return new Draw(canvas) }

            clear() {
                const ctx = this.canvas.getContext("2d")
                ctx.clearRect(0, 0, canvas.width, canvas.height)

                return true
            }

            /**
             * 繪製圓圈
             * @param {Circle} cir 
             */
            circle(cir) {
                const ctx = this.canvas.getContext("2d")

                ctx.beginPath()
                const fs = `rgba(${255 - cir.color.r}, ${255 - cir.color.g}, ${255 - cir.color.b}, ${cir.alpha.val})`
                ctx.fillStyle = fs
                // console.log(fs)
                // ctx.strokeStyle = `rgba(255, 255, 255, ${cir.alpha / 100})`
                // ctx.lineWidth = 5
                ctx.arc(cir.site.x, cir.site.y, cir.radius, 0, Math.PI * 2)
                ctx.fill()
                // ctx.stroke()

                // console.log(cir.site.x, cir.site.y, cir.radius)

                return true
            }
        }

        class Contral {
            constructor(canvas) {
                this.canvas = canvas
                this.circles = []
            }
            static get init() {
                const canvas = document.getElementById("canvas")
                canvas.height = window.innerHeight
                canvas.width = window.innerWidth

                return new Contral(canvas)
            }

            addCircle(num) {
                for (let i = 0; i < num; i += 1)
                    this.circles.push(Circle.init)

                return this
            }

            update() {
                for (let i = 0; i < this.circles.length; i += 1) {
                    const circle = this.circles[i].update()
                    if (circle.alpha.times > 1) {
                        this.circles.splice(i, 1)
                        this.circles[i].update()
                    }
                }

                return this
            }

            draw() {
                Draw.init(this.canvas).clear()
                this.circles.map(circle => Draw.init(this.canvas).circle(circle))
            }

            loop() {
                if (Math.random() > 0.985) this.addCircle(1)
                this.update().draw()
                window.requestAnimationFrame(this.loop.bind(this))
            }
        }

        Contral.init.loop()
    </script>
</body>

</html>